<?php
class BrinkCurl extends SplickitCurl
{
    static function curlIt($url,$xml,$headers)
    {
        //<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><CalculateOrderResponse xmlns="http://www.brinksoftware.com/webservices/ordering/20140219"><CalculateOrderResult xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Message i:nil="true" xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service"/><ResultCode xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">0</ResultCode><Order><Balance>5.82</Balance><BusinessDate>2015-07-16T00:00:00</BusinessDate><CreatedTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-17T20:07:06.8232116Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></CreatedTime><CustomerId>00000000-0000-0000-0000-000000000000</CustomerId><DestinationId>3</DestinationId><Discounts/><Entries><OrderEntry i:type="OrderItem"><Description>BLT Sm Pita</Description><Id>1</Id><ItemId>4003804</ItemId><Price>5.49</Price><Promotions/><CompositeOrderItemId>0</CompositeOrderItemId><DestinationId>3</DestinationId><Discounts/><Modifiers><OrderItemModifier><Description>White Pita</Description><Id>2</Id><ItemId>4003423</ItemId><ModifierCodeId>0</ModifierCodeId><ModifierGroupId>4009469</ModifierGroupId><Modifiers/><Price>0.000</Price><Taxes><OrderEntryTax><Amount>0</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax><OrderEntryTax><Amount>0</Amount><Id>2</Id><TaxId>6</TaxId></OrderEntryTax></Taxes></OrderItemModifier></Modifiers><Note i:nil="true"/><Taxes><OrderEntryTax><Amount>0.33</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax></Taxes></OrderEntry></Entries><FutureOrder><Delivery i:nil="true"/><EmailAddress>bobnewhart@dummy.com</EmailAddress><IsCancelled>false</IsCancelled><PhoneNumber>888 888 8888</PhoneNumber><PickupTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-18T18:19:00Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></PickupTime></FutureOrder><Id>0</Id><IdEncoded>AAAAAAAAAAAA</IdEncoded><IsClosed>false</IsClosed><IsSent>false</IsSent><IsTaxExempt>false</IsTaxExempt><LaneId>0</LaneId><Name>Bob Newhart</Name><Number>-1</Number><Payments/><Promotions/><SectionId>0</SectionId><Subtotal>5.490</Subtotal><Surcharges/><Tax>0.33</Tax><Total>5.820</Total></Order></CalculateOrderResult></CalculateOrderResponse></s:Body></s:Envelope>
        myerror_log($xml);
        myerror_log("the count is: ".substr_count('CalculateOrder',$xml));
        if ($_SERVER['BRINK_TIMEOUT']) {
            $response['error'] = 'Timeout';
            $response['error_no'] = 28;
            myerror_log("Curl Error: ".$response['error']);
            return $response;
        }
        if (substr_count($xml,'CalculateOrder') > 0) {
            // Good request
            if (false && substr_count($xml,'<Delivery><Address1>') > 0) {
                ;
            } else if (substr_count($xml,'<DiscountId>') > 0) {
                $response['raw_result'] = '<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><CalculateOrderResponse xmlns="http://www.brinksoftware.com/webservices/ordering/20140219"><CalculateOrderResult xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Message i:nil="true" xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service"/><ResultCode xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">0</ResultCode><Order><Balance>1.10</Balance><BusinessDate>2015-07-16T00:00:00</BusinessDate><CreatedTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-17T20:07:06.8232116Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></CreatedTime><CustomerId>00000000-0000-0000-0000-000000000000</CustomerId><DestinationId>3</DestinationId><Discounts/><Entries><OrderEntry i:type="OrderItem"><Description>BLT Sm Pita</Description><Id>1</Id><ItemId>4003804</ItemId><Price>1.50</Price><Promotions/><CompositeOrderItemId>0</CompositeOrderItemId><DestinationId>3</DestinationId><Discounts/><Modifiers><OrderItemModifier><Description>White Pita</Description><Id>2</Id><ItemId>4003423</ItemId><ModifierCodeId>0</ModifierCodeId><ModifierGroupId>4009469</ModifierGroupId><Modifiers/><Price>0.500</Price><Taxes><OrderEntryTax><Amount>0</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax><OrderEntryTax><Amount>0</Amount><Id>2</Id><TaxId>6</TaxId></OrderEntryTax></Taxes></OrderItemModifier></Modifiers><Note i:nil="true"/><Taxes><OrderEntryTax><Amount>0.20</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax></Taxes></OrderEntry></Entries><FutureOrder><Delivery i:nil="true"/><EmailAddress>bobnewhart@dummy.com</EmailAddress><IsCancelled>false</IsCancelled><PhoneNumber>888 888 8888</PhoneNumber><PickupTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-18T18:19:00Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></PickupTime></FutureOrder><Id>0</Id><IdEncoded>AAAAAAAAAAAA</IdEncoded><IsClosed>false</IsClosed><IsSent>false</IsSent><IsTaxExempt>false</IsTaxExempt><LaneId>0</LaneId><Name>Bob Newhart</Name><Number>-1</Number><Payments/><Promotions/><SectionId>0</SectionId><Subtotal>1.000</Subtotal><Surcharges/><Tax>0.100</Tax><Total>1.100</Total></Order></CalculateOrderResult></CalculateOrderResponse></s:Body></s:Envelope>';
                $response['http_code'] = 200;
            } else {
                $response['raw_result'] = '<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><CalculateOrderResponse xmlns="http://www.brinksoftware.com/webservices/ordering/20140219"><CalculateOrderResult xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Message i:nil="true" xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service"/><ResultCode xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">0</ResultCode><Order><Balance>2.20</Balance><BusinessDate>2015-07-16T00:00:00</BusinessDate><CreatedTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-17T20:07:06.8232116Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></CreatedTime><CustomerId>00000000-0000-0000-0000-000000000000</CustomerId><DestinationId>3</DestinationId><Discounts/><Entries><OrderEntry i:type="OrderItem"><Description>BLT Sm Pita</Description><Id>1</Id><ItemId>4003804</ItemId><Price>1.50</Price><Promotions/><CompositeOrderItemId>0</CompositeOrderItemId><DestinationId>3</DestinationId><Discounts/><Modifiers><OrderItemModifier><Description>White Pita</Description><Id>2</Id><ItemId>4003423</ItemId><ModifierCodeId>0</ModifierCodeId><ModifierGroupId>4009469</ModifierGroupId><Modifiers/><Price>0.500</Price><Taxes><OrderEntryTax><Amount>0</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax><OrderEntryTax><Amount>0</Amount><Id>2</Id><TaxId>6</TaxId></OrderEntryTax></Taxes></OrderItemModifier></Modifiers><Note i:nil="true"/><Taxes><OrderEntryTax><Amount>0.20</Amount><Id>1</Id><TaxId>1</TaxId></OrderEntryTax></Taxes></OrderEntry></Entries><FutureOrder><Delivery i:nil="true"/><EmailAddress>bobnewhart@dummy.com</EmailAddress><IsCancelled>false</IsCancelled><PhoneNumber>888 888 8888</PhoneNumber><PickupTime xmlns:a="http://schemas.datacontract.org/2004/07/System"><a:DateTime>2015-07-18T18:19:00Z</a:DateTime><a:OffsetMinutes>0</a:OffsetMinutes></PickupTime></FutureOrder><Id>0</Id><IdEncoded>AAAAAAAAAAAA</IdEncoded><IsClosed>false</IsClosed><IsSent>false</IsSent><IsTaxExempt>false</IsTaxExempt><LaneId>0</LaneId><Name>Bob Newhart</Name><Number>-1</Number><Payments/><Promotions/><SectionId>0</SectionId><Subtotal>2.000</Subtotal><Surcharges/><Tax>0.200</Tax><Total>2.200</Total></Order></CalculateOrderResult></CalculateOrderResponse></s:Body></s:Envelope>';
                $response['http_code'] = 200;
            }


        } else if (substr_count($xml,'SubmitOrder') > 0) {
            if (false) {
                // store is offline
                $response['raw_result'] = '<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><SubmitOrderResponse xmlns="http://www.brinksoftware.com/webservices/ordering/20140219"><SubmitOrderResult xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Message xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">Store is offline</Message><ResultCode xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">101</ResultCode><OrderId>0</OrderId></SubmitOrderResult></SubmitOrderResponse></s:Body></s:Envelope>';
                $response['http_code'] = 200;
            } else {
                $response['raw_result'] = '<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"><s:Body><SubmitOrderResponse xmlns="http://www.brinksoftware.com/webservices/ordering/20140219"><SubmitOrderResult xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Message i:nil="true" xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service"/><ResultCode xmlns="http://schemas.datacontract.org/2004/07/Pos.Web.Service">0</ResultCode><OrderId>'.time().'</OrderId></SubmitOrderResult></SubmitOrderResponse></s:Body></s:Envelope>';
                $response['http_code'] = 200;
            }

        } else {
            $response['http_code'] = 500;
        }
        return $response;
    }
}
?>
